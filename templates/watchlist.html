{% extends "base.html" %}
{% set active_page = "watchlist" %}

{% block head %}
{{super()}}
<link rel="stylesheet" href="/static/css/watchlist.css">
<link rel="stylesheet" href="/static/css/movie.css">
{% endblock %}

{% block title %}Watchlist{% endblock %}

{% block content %}

<div class="container">
    <section class="watchlist-container">
        <h2><i class="icon-tv"></i> {{user.first_name|title}}'s Watchlist</h2>
        {% if watchlist|length == 0 %}
        <h3>Go to the <a href="{{url_for('explore.root')}}">Explore</a> tab and find some movies to add here.</h3>
        {% else %}
        <div class="gradient-background row-full"></div>
        {% with movies = watchlist %}
            {% include "components/movie-list.html" %}
        {% endwith %}
        {% endif %}
    </section>
    <section>
        <h2><i class="icon-history" style="font-size: 27px;"></i> History</h2>
        {% if history|length == 0 %}
        <h3>Movies that you've watched will show up here.</h3>
        {% else %}
        <div class="history-container">
            <table class="mx-auto">
                <tr>
                    <th>DATE</th>
                    <th>TITLE</th>
                    <th>GENRES</th>
                    <th></th>
                </tr>
                {% for movie in history %}
                <tr>
                    <td class="shrink date-container" style="padding-right: 40px;">
                        {% set date = movie.date.strftime('%Y-%m-%d') %}
                        <div class="date">
                            {{date}}
                            <button type="submit"><i class="icon-pencil"></i></button>
                        </div>
                        <form action="{{url_for('watchlist.edit_history', item_id=movie.id)}}" method="POST" style="display: none;">
                            <input type="date" value="{{date}}" name="date">
                            <button type="submit"><i class="icon-check"></i></button>
                        </form>
                    </td>
                    <td class="expand">{{movie.title}} ({{movie.year}})</td>
                    <td class="shrink">{{movie.genres|batch(3)|first|join(", ")}}</td>
                    <td>
                        <form action="{{url_for('watchlist.remove_history', item_id=movie.id)}}" method="POST">
                            <button type="submit" class="edit-button"><i class="icon-bin"></i></button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
        
    </section>
</div>

{% endblock %}

{% block scripts %}
{{super()}}
<script src="/static/js/watchlist.js"></script>
{% endblock %}